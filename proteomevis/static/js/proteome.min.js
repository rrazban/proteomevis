function main(){function a(a,b){return null!==b?d3.format("."+b+"f")(a):d3.format(".3f")(a)}function u(a,b,c){if(a.preventDefault(),"pcg-node"==b){var d=d3.select(c);f=d.data()[0],d3.select("#liRemove").classed("disabled",!d.classed("highlight")),d.classed("highlight",!0)}$("#"+b+".custom-menu").finish().toggle(100).css({top:a.pageY-0+"px",left:a.pageX+"px"})}function y(){function y(){d3.select(".toggle.btn").style("display",data.species_has_mutant_data?null:"none"),j.updateVis(),n.updateVis(),q.update(),"clusterListTab"==v.view&&s.updateVis(),u.clear("#cluster_list"),E.hide()}function z(a,c){h?data.edges?c?B(y):y():b.show(data.errorMessage):(a+=1,a>3?b.show("You've selected too many edges. Try selecting a smaller area."):setTimeout(function(){z(a,c)},3e3))}var a=new Highlighter,b=new ErrorMessage,d=new TypeVis("#typeVis"),g=new TypeLimitsVis(d3.select("#typelimitsVis"),$("#typelimitsVis").height(),$("#typelimitsVis").width()),i=new ProteinSearch(d3.select("#nodeList")),j=new SplomVis("#splomVis",!0),n=(new SplomBar("#splomVis"),new ForceVis("#pcgVis")),o=new TMSID,p=new AttributesEditor,q=new NodeColorVis("#nodeColor");c=new TipLink(l);var s=new ClusterScatter(d3.select("#clusterScatter"),300,$("#clusterList").width()),t=new ClusterList(d3.select("#clusterList")),u=new ProteinMediaItem,v=new ViewTab;new DataExportModal;D.hide(),k.style("left","10px").style("top",$("#forceLayoutDiv").position().top+"px"),l.style("left","10px").style("top",$("#forceLayoutDiv").position().top+"px"),$("#individual_list").height($("#view").height()-90),$(e).bind("dataChanged",function(b,c){typevisBrush=c,E.show(),a.updateHighlight(),A(function(){z(0)})}),$(e).bind("speciesChanged",function(b){E.show(),A(function(){document.title="ProteomeVis",u.clear(),a.removeHighlight(),d.updateImage(),z(0,!0)})}),$(e).bind("nodeColorChanged",function(a){n.updateColor(),"clusterListTab"==v.view&&s.updateColor()}),$(e).bind("displayData",function(a,b){g.updateVis()}),$(e).bind("focus-forcevis",function(a,b){n.updateVis(b)}),$(e).bind("manualLimitsChanged",function(a){d.updateBrush(!0)}),$(e).bind("updateSplom",function(a){A([ss.tmi,ss.tmf,ss.sidi,ss.sidf],function(){z(0),j=new SplomVis("#splomVis")})}),$(e).bind("nodeClicked",function(b,c){o.addLinks(c),$.when(i.individualSearch(c.domain,!1)).done(function(){a.highlight(c.id)})}),$(e).bind("bigSplomValuesSelected",function(a,b){b.ids.forEach(function(a){$(e).trigger("nodeClicked",data.nodes[ID2i(a)])}).toUpperCase()}),$(e).bind("highlightDomains",function(b,c){c.data.forEach(function(b){a.highlight(b)})}),$(e).bind("badgeClicked",function(b,c){a.removeProtein(c),a.highlight(c)}),$(e).bind("removeHighlight",function(b,c){var d=c?c.chains.map(function(a){return a.id}):[f.id];a.removeHighlight(d),i.removeProtein(c.domain)}),$(e).bind("clusterHighlight",function(b,c,d){a.hoverHighlight(c,d)}),$(e).bind("removeClusterHighlight",function(b){a.removeHoverHighlight()}),$(e).bind("clusterClicked",function(b,c,d){d3.select(".cluster.c"+d).classed("highlight")||(a.highlight(null,d),t.addContent(c))}),$(e).bind("updateClusterScatter",function(a){s.updateVis()}),$(e).bind("add-to-individual-list",function(a,b){u.addDomainsToList(b.domainData,d3.select("#individual_list"))}),$(e).bind("add-to-cluster-list",function(a,b){var c="#list"+b.cluster.id;u.addDomainsToList(b.domainData,d3.select(c),b.cluster.id)}),$(e).bind("getClusterDetails",function(a,b){i.clusterSearch(b,!1)}),$(e).bind("scrunch",function(a){setTimeout(function(){s.scrunch()},100)}),$(e).bind("clusterInfo",function(a){v.switchView("clusterListTab"),$(e).trigger("clusterClicked",[data.clusters[f.cluster],f.cluster])}),$(e).bind("changeScale",function(a,b){var c=b.split("-");r.changeScale(c[0],c[1])}),$(e).bind("node-focus",function(a,b){o.focusNode(f)}),$(e).bind("openModal",function(a){p.openModal()}),$(e).bind("windowResize",function(a){x(),d.setHeight(),n.setHeight()})}function z(){d3.csv("../static/attributes/attributes.csv",function(a){a.forEach(function(a){a.magnitude=+a.magnitude,a.order=+a.order,a.decimal=+a.decimal,a.log=+a.log}),attributes=new AttributesManager(a),A(function(){C(0)})})}function A(a){h=!1;var b=$.param({columns:attributes.active(),species:ss.species,TMi:ss.tmi,TMf:ss.tmf,SIDi:ss.sidi,SIDf:ss.sidf,mutants:ss.mutants}),c=$.ajax({url:"fetch_edges/",type:"POST",data:b}).done(function(b){data=b,a(),h=!0});setTimeout(function(){c.abort()},6e3)}function B(a){var b=data.nodes.map(function(a,b){return b}),c=data.nodes.map(function(a,b){return a.id});ID2i=d3.scale.ordinal().domain(c).range(b),i2ID=d3.scale.ordinal().domain(b).range(c),a&&a()}function C(a){h?B(y):(a+=1,a>5?errorMessage.show("You've selected too many edges. Try selecting a smaller area."):setTimeout(function(){C(a)},1e3))}var b,c,f,e={};$(window).resize(function(){$(e).trigger("windowResize")}),ss.tmi=0,ss.tmf=0,ss.sidi=0,ss.sidf=0,ss.species="yeast",ss.mutants=!0;var g,h,r,j="degree",k=d3.select("#tooltip"),l=d3.select("#link-tooltip"),m={discrete:["white","lightgrey","darkgrey","grey","black"],continuous:["white","black"]},n=d3.scale.linear().range(m.continuous),o=function(a){return n(a[j])},p={height:0,width:0},q=12,s=d3.scale.linear().domain([0,.05,.1]).range(["red","black","white"]),t=d3.scale.ordinal().range(["#B3D580","#88CB8C","#AABAD3","#FFCC80","#80CCE3","#99B3E6","#6F92D8","#56B45B","#92C24A","#6D90B2","#920BD8","#C2C256","#4EA1A1","#99C9B1","#F3B980","#D5D588","#B399E6","#C58383","#91D5CC","#B288B3","#CCA2CC","#98B1CA","#CC80CC"]);$(document).bind("mousedown",function(a){!$(a.target).parents(".custom-menu").length>0&&$(".custom-menu").hide(100)}),$(".custom-menu li").click(function(){switch($(this).parent().attr("id")){case"pcg-node":$(e).trigger($(this).attr("data-action"));break;case"big-splomvis":$(e).trigger($(this).attr("data-action"),$(this).attr("value"))}$(".custom-menu").hide(100)});var v=function(a){return a.slice(0,-1)+a.slice(-1).toUpperCase()},w=function(a){return"<img class='media-object' src ='../static/img/"+a[0]+"/"+a[1]+"/"+v(a)+".png'>"},x=function(){p.height=window.innerHeight-G-F,p.width=window.innerWidth-2*F;var a=.3*p.width,b=.4*p.width,c=.3*p.width;$("#typeVis").height(.35*p.height),$("#typeVis").width(a),$("#pcgVis").height(.65*p.height),$("#pcgVis").width(a),$("#splomVis").height(p.height+17),$("#splomVis").width(b),$("#view").width(c),$("#view").height(p.height+17),$("head").append("<style>.media { width:"+(c-20)+"px;}</style>")},D=function(){var a=$("#pleaseWaitDialogInitial");return{show:function(){a.modal()},hide:function(){a.modal("hide")}}}(),E=function(){var a=$("#pleaseWaitDialog");return{show:function(){a.modal()},hide:function(){a.modal("hide")}}}();D.show();var F=30,G=65;x(),z(),TypeVis=function(b){function j(){g=$(b).height()-f.top-f.bottom-q,h=$(b).width()-f.left-f.right,k.range([f.left,h]),l.range([g,f.top]),o.attr("width",h+f.left+f.right).attr("height",g+f.top+f.bottom),p.attr("width",h).attr("height",g),r.select(".x.axis").attr("transform","translate(0,"+g+")"),r.select(".x.label").attr("x",h).attr("y",g-6),r.select(".x.axis").call(m),r.select(".y.axis").call(n),d.updateBrush(!1)}var c=d3.select(b),d=this,f={top:5,right:10,bottom:25,left:20},g=$(b).height()-f.top-f.bottom,h=$(b).width()-f.left-f.right,k=d3.scale.linear().domain([0,1]).range([f.left,h]),l=d3.scale.linear().domain([0,1]).range([g,f.top]),m=d3.svg.axis().scale(k).orient("bottom"),n=d3.svg.axis().scale(l).orient("left"),o=c.append("svg").attr("width",h+f.left+f.right).attr("height",g+f.top+f.bottom),p=o.append("svg:image").attr("width",h).attr("height",g).attr("transform","translate("+2*f.left+","+f.top+")").attr("preserveAspectRatio","none").attr("xlink:href","../static/img/"+ss.species+".png"),r=o.append("g").attr("transform","translate("+f.left+","+f.top+")");r.append("g").attr("class","x axis").attr("transform","translate(0,"+g+")").call(m),r.append("g").attr("class","y axis").attr("transform","translate("+f.left+",0)").call(n),r.append("text").attr("class","x label").attr("text-anchor","end").text("TM"),r.append("text").attr("class","y label").attr("y",f.top).attr("x",f.left+10).attr("dy",".75em").text("SID");var s=d3.svg.brush().x(k).y(l).on("brush",function(){t(d,!1)}).on("brushend",function(){t(d,!0)});r.append("g").attr("class","brush").call(s);var t=function(b,c){var d=s.extent();ss.tmi=a(d[0][0]),ss.sidi=a(d[0][1]),ss.tmf=a(d[1][0]),ss.sidf=a(d[1][1]),c&&$(e).trigger("dataChanged",s.empty()),$(e).trigger("displayData",s.empty())};this.updateBrush=function(a){var b=[[ss.tmi,ss.sidi],[ss.tmf,ss.sidf]];r.select(".brush").transition().call(s.extent(b)),a&&ss.tmi!==ss.tmf&&ss.sidi!==ss.sidf&&r.select(".brush").call(s.event)},this.updateImage=function(){p.attr("xlink:href","../static/img/"+ss.species+".png")},j(),this.setHeight=function(){j()}},ForceVis=function(a){function l(){i=$(a).height()-g.top-g.bottom-q-h,j=$(a).width()-g.left-g.right,b.size([j,i]),c.select("svg").attr("width",j+g.left+g.right).attr("height",i+g.top+g.bottom),x.attr("width",j+g.left+g.right).attr("height",i+g.top+g.bottom),y.attr("width",j+g.left+g.right).attr("height",i+g.top+g.bottom),z.attr("transform","translate("+j/2+","+i/2+") scale(0.35)"),k.style("top",$("#forceLayoutDiv").position().top+"px")}var c=d3.select(a),f=null,g={top:10,right:10,bottom:15,left:10},h=30,i=$(a).height()-g.top-g.bottom-h-q,j=$(a).width()-g.left-g.right;this.setHeight=function(){l()};var m=function(a){return f.filter(function(b){return b.source.id==a||b.target.id==a})[0]},n=function(a){return"M "+a.source.x+" "+a.source.y+" L "+a.target.x+" "+a.target.y},r=function(a){A.attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y}),B.attr("d",n)},s=c.append("div").attr("class","progress").append("div").attr("class","progress-bar").attr("id","nodesDisplayedBar").style("width","0%").attr("title","0 chains shown");b=d3.layout.force().on("tick",r).charge(function(a){return a.highlight?-500:-200}).friction(.7).gravity(.35).linkDistance(80).size([j,i]);var t=function(){var a=[d3.event.translate[0]+j/2,d3.event.translate[1]+i/2];z.attr("transform","translate("+a+") scale("+d3.event.scale+")")},v=d3.behavior.zoom().scaleExtent([.1,10]).scale([.35]).on("zoom",t);tip=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(a,b,c){return data.nodes[ID2i(a)].pdb+" to "+b.pdb+"<br><b>TM</b>"+c.tm+"<br><b>SID</b>"+c.sid});var A,B,x=c.append("div").attr("id","forceLayoutDiv").append("svg").attr("width",j+g.left+g.right).attr("height",i+g.top+g.bottom).append("g").attr("class","graph").call(v).call(tip),y=x.append("rect").attr("width",j+g.left+g.right).attr("height",i+g.top+g.bottom).style("fill","none").style("pointer-events","all"),z=x.append("g").attr("class","vis"),D=function(a){k.style("opacity",1).html(w(a.pdb)+a.pdb.toUpperCase()),$(e).trigger("clusterHighlight",[data.clusters[a.cluster],a])},E=function(){k.style("opacity",0),$(e).trigger("removeClusterHighlight")};this.updateVis=function(a){a?(f=a.edges,F()):G()};var F=function(){b.linkDistance(100),I();var a=d3.select(".highlight-center").data()[0].id;b.nodes(data.nodes).links(f).start(),A=z.selectAll("circle.pcg").data(data.nodes.filter(function(a){return a.highlight}),function(a){return a.id}),A.enter().append("circle").attr("class",function(a){return"highlight pcg p"+a.id+" c"+a.cluster}),A.attr("fill",o).on("click",function(a){d3.select(this).classed("highlight",!0),$(e).trigger("nodeClicked",a),b.start()}),z.selectAll(".highlight:not(.center)").on("mouseover",function(b){linkTip.show(a,b,m(b.id))}).on("mouseout",function(a){linkTip.hide()}),$("circle.pcg").bind("contextmenu",function(a){u(a,"pcg-node",this)}),A.exit().remove(),B=z.selectAll(".link").data(f,function(a){return H(a.source.id,a.target.id)}),B.enter().insert("path",".pcg").attr("class","link"),B.classed("ppi",function(a){return a.ppi}).classed("dashed",function(a){return a.dashed}).attr("id",function(a){return H(a.source.id,a.target.id)}),B.exit().remove(),z.attr("transform","translate("+j/2+","+i/2+") scale(0.35)"),b.start()},G=function(){b.linkDistance(50),A=z.selectAll("circle.pcg").data(data.nodes.filter(function(a){return a.degree})),I(),b.nodes(data.nodes).links(data.edges).start(),A.enter().append("circle"),A.attr("class",function(a){return"pcg p"+a.id+" c"+a.cluster}).attr("fill",o).on("click",function(a){d3.select(this).classed("highlight",!0),$(e).trigger("nodeClicked",a),b.start()}).on("mouseover",D).on("mouseout",E),$("circle.pcg").bind("contextmenu",function(a){u(a,"pcg-node",this)}),A.exit().remove(),B=z.selectAll(".link").data(data.edges,function(a){return H(a.source.id,a.target.id)}),B.enter().insert("path",".pcg").attr("class","link"),B.classed("ppi",function(a){return a.ppi}).attr("id",function(a){return H(a.source.id,a.target.id)}),B.exit().remove(),z.attr("transform","translate("+j/2+","+i/2+") scale(0.35)"),b.start()};this.updateColor=function(){A.attr("fill",o)};var H=function(a,b){return"ls"+Math.min(a,b)+"t"+Math.max(a,b)},I=function(){var a=data.nodes.length,b=data.nodes.filter(function(a){return a.degree}).length;s.style("width",100*b/a+"%").attr("title",b+" of "+a+" shown")}},NodeColorVis=function(a){function i(a){return a[0]==a[1]?null:a}function k(a){return function(b){return[b[0]/Math.pow(10,a),b[1]/Math.pow(10,a)]}}var b=d3.select(a),d={top:0,right:10,bottom:15,left:20},f=15,g=2*f,h=5*g,l=b.append("select");l.style("vertical-align","top").attr("class","form-control").attr("id","nodeColorSelect").selectAll("option").data(attributes.all()).enter().append("option").attr("value",function(a){return a}).html(function(a){return attributes.prettyprint1(a)}),l.on("change",function(){j=$("#nodeColorSelect option:selected").val(),updateVis()});var o=b.append("svg").attr("id","legendSVG").attr("width",h+d.left+d.right).attr("height",f+d.top+d.bottom).append("g").attr("transform","translate("+d.left+","+d.top+")");o.append("pattern").attr({id:"striped",width:4,height:8,patternUnits:"userSpaceOnUse",patternTransform:"rotate(55)"}).append("rect").attr("width",3).attr("height",8).attr("fill","lightgray");var p=o.append("g").attr("id","legend");p.selectAll(".color-block").data(d3.range(5)).enter().append("svg:rect").attr("class","color-block").attr("x",function(a){return a*g+"px"}).attr("height",f+"px").attr("width",g+"px").attr("y","0px").attr("fill",function(a){return m.discrete[a]}).attr("stroke","none");var q=d3.scale.linear().range([0,h]),r=d3.svg.axis().scale(q).orient("bottom").tickSize(2).ticks(3).tickFormat(d3.format(".1f")),s=o.append("g").attr("transform","translate(0,"+f+")").attr("class","x axis").call(r);s.select("path.domain").style("display","none");var t=b.append("div").style("display","inline").attr("id","color-scale-suffix");updateVis=function(){var a=attributes.magnitude(j),b=i(data.domains[j]),c=k(a);b&&ss.tmi!==ss.tmf&&ss.sidi!==ss.sidf?(n.domain(b),q.domain(c(b)),p.selectAll(".color-block").classed("striped",!1),s.style("display",null).call(r),$(e).trigger("nodeColorChanged"),t.style("display","inline").html(" &times; 10<sup>"+a+"</sup>")):(s.style("display","none"),p.selectAll(".color-block").classed("striped",!0),t.style("display","none"))},this.update=function(){updateVis()},updateVis(j)},TypeLimitsVis=function(b){var g=document.getElementById("TMi"),h=document.getElementById("TMf"),i=document.getElementById("SIDi"),j=document.getElementById("SIDf"),k=d3.selectAll("[name=speciesBtn]");k.on("click",function(){this.value!==ss.species&&(ss.species=this.value,k.classed("active",!1),d3.select(this).classed("active",!0),$(e).trigger("speciesChanged"))}),$("#toggleMutant").change(function(){ss.mutants=$(this).prop("checked"),console.log(ss.mutants),$(e).trigger("speciesChanged")}),$(".typeLimitsInput").on("enterKey",function(){$(this).value=this.value,ss.tmi=g.value,ss.tmf=h.value,ss.sidi=i.value,ss.sidf=j.value,$(e).trigger("manualLimitsChanged")}),this.updateVis=function(){g.value=a(ss.tmi),h.value=a(ss.tmf),i.value=a(ss.sidi),j.value=a(ss.sidf)},d3.select("#downloadAllDataBtn").on("click",function(){$("#mlDataexport").html("Download options - all proteins"),d3.select("#numedges_adddisclaimer_label").classed("disabled",ss.tmi==ss.tmf&&ss.sidi==ss.sidf)})},SplomBar=function(a){var b=d3.select(a).select("#splom-bar"),c=$(a).width(),d=40,f={left:10,right:20,top:7.5,bottom:7.5},g={bar:c-d-f.left-f.right,button:d},h={text:10,bar:15},i=(new Colorbar).scale(s).thickness(h.bar).barlength(g.bar).orient("horizontal"),j=b.append("svg").attr("width",g.bar+f.left+f.right).attr("height",h.bar+f.top+f.bottom+h.text).append("g").attr("transform","translate("+f.left+","+f.top+")");j.call(i),b.select("svg.colorbar").append("text").attr("transform","translate("+(f.left+5)+","+(h.bar+f.top)/2+")").text("P-VALUE").attr("class","text-subtitle").style("fill","white");b.append("span").append("button").attr("id","editAttributesButton").attr("type","button").attr("class","btn btn-default").attr("data-toggle","modal").attr("data-target","#editAttributes").on("click",function(){$(e).trigger("openModal")}).html("<span class='glyphicon glyphicon-edit'></span>")},AttributesEditor=function(){var a=this,b=d3.select("#attributes-unused"),c=d3.select("#attributes-used"),d=d3.select("#btnSaveAttributes");d.on("click",function(){a.modalClosed()}),this.openModal=function(){b.selectAll("li").remove(),c.selectAll("li").remove();var a=attributes.inactive(),d=attributes.active();b.selectAll("li").data(a).enter().append("li").attr("value",function(a){return a}).text(function(a){return attributes.prettyprint1(a)}),c.selectAll("li").data(d).enter().append("li").attr("value",function(a){return a}).text(function(a){return attributes.prettyprint1(a)})},this.modalClosed=function(){var a=d3.select("#attributes-used").selectAll("li")[0].map(function(a){return $(a).attr("value")});attributes.setOrder(a),$(e).trigger("updateSplom")}},SplomFocusPlot=function(b,c,d){function J(){if(v.empty())d3.select("#btnBigSplomHighlight").style("display","none"),d3.selectAll("circle").classed("faded",!1),k=[];else{d3.select("#btnBigSplomHighlight").style("display","inline").on("click",K);var a=v.extent();k=j.filter(function(b){return b[0]>a[0][0]&&b[0]<a[1][0]&&b[1]>a[0][1]&&b[1]<a[1][1]}).map(function(a){return a[2]}),d3.selectAll("circle").classed("faded",!0),k.forEach(function(a){d3.selectAll("circle.p"+a).classed("faded",!1)})}}function K(){$(e).trigger("bigSplomValuesSelected",{ids:k})}var h,i,j,k,l={top:5,right:10,bottom:50,left:20},m=d3.max([(c+2*d)/2,250]),n={height:$("#splom").height(),width:$("#splom").width()},o=n.height-m-l.top-l.bottom,p=n.width-m-l.left-l.right,q={size:12,position:100},r=d3.scale.linear().range([0,p]).domain([0,1]),s=d3.scale.linear().range([o,0]).domain([0,1]),t=d3.svg.axis().scale(r).orient("bottom"),u=d3.svg.axis().scale(s).orient("left"),v=d3.svg.brush().x(r).y(s).on("brushend",J),w=d3.select(b).select("svg").append("g").attr("id","splomfocusplot-details").attr("transform","translate("+l.left+","+(c-2*d)+")"),x=w.append("g").attr("class","detail-labels"),y=w.append("g").attr("class","detail-values");x.append("text").attr("x",1.5*q.position).attr("class","text-subtitle").text("LINREGRESS"),x.append("text").attr("x",q.position).attr("y",1.25*q.size).text("p-value"),x.append("text").attr("x",q.position).attr("y",2.5*q.size).text("r-value"),x.append("text").attr("x",q.position).attr("y",3.75*q.size).text("regression"),x.append("text").attr("x",q.position).attr("y",5*q.size).text("standard error"),x.append("text").attr("x",1.5*q.position).attr("y",6.25*q.size).attr("class","text-subtitle").text("SPEARMAN"),x.append("text").attr("x",q.position).attr("y",7.5*q.size).text("p-value"),x.append("text").attr("x",q.position).attr("y",8.75*q.size).text("rho");var z=y.append("text").attr("x",q.position+10).attr("y",1.25*q.size),A=y.append("text").attr("x",q.position+10).attr("y",2.5*q.size),B=y.append("text").attr("x",q.position+10).attr("y",3.75*q.size),C=y.append("text").attr("x",q.position+10).attr("y",5*q.size),D=y.append("text").attr("x",q.position+10).attr("y",7.5*q.size),E=y.append("text").attr("x",q.position+10).attr("y",8.75*q.size),F=d3.select(b).select("svg").append("g").attr("id","splomfocusplot").attr("transform","translate("+m+","+m+")");F.append("rect").style("visibility","hidden").style("pointer-events","all").attr("x",0).attr("y",0).attr("height",o).attr("width",p),F.append("g").attr("class","x axis").attr("transform","translate(0,"+o+")"),F.append("g").attr("class","y axis");var G=F.append("path").attr("class","correlation-line"),H=F.append("text").attr("class","x label").attr("text-anchor","end").attr("x",p).attr("y",o-6);F.call(v);var I=F.append("text").attr("class","y label").attr("y",l.top).attr("x",l.left).attr("dy",".75em");this.plot=function(b,c){if(h=b?b:h,i=c?c:i){console.log(d3.select(h).data()),r.domain(data.domains[i.x]),s.domain(data.domains[i.y]);var d=data.correlations[i.i][i.j];z.text(d.p_value),A.text(d.r_value),B.text(d.slope+"x + "+d.intercept),C.text(d.std_err),E.text(a(d.rho_SP,3)),D.text(a(d.p_value_SP,3)),j=d3.select(h).selectAll("circle").data();var e=F.selectAll("circle").data(j);e.enter().append("circle"),e.attr("class",function(a){return"splom graph big-graph p"+a[2]+" c"+a[3]}).attr("cx",function(a){return r(a[0])}).attr("cy",function(a){return s(a[1])}),e.exit().remove(),H.html(attributes.prettyprint1(i.x)),I.html(attributes.prettyprint1(i.y)),t=d3.svg.axis().scale(r).orient("bottom"),u=d3.svg.axis().scale(s).orient("left");var f=d3.svg.line().interpolate("linear").x(function(a){return r(a.x)}).y(function(a){return s(a.y)});G.datum(i.points).attr("d",f),F.select(".x.axis").call(t),F.select(".y.axis").call(u)}},this.displayCell=function(a){F.attr("display",a?null:"none")}},SplomVis=function(b,c){function t(a,b){var f,g,c=[],d=a.length,e=b.length;for(f=-1;++f<d;!0)for(g=-1;++g<e;!0)c.push({x:a[f],i:f,y:b[g],j:g,points:z(a[f],f,b[g],g)});return c}function u(a,b){var d=d3.select(b);if(d.select("rect").attr("fill",function(a){return a.i==a.j?"none":"white"}),a.i>a.j){o.domain(data.domains[a.x]),p.domain(data.domains[a.y]);var e=d3.svg.line().interpolate("linear").x(function(a){return o(a.x)}).y(function(a){return p(a.y)}),f=y(a);d.select("rect").style("fill",function(b){var c=data.correlations[a.i][a.j];return Math.abs(c.rho_SP)>.15?s(data.correlations[a.i][a.j].p_value_SP):"white"});var g=d.selectAll("circle."+a.x+"-"+a.y).data(f);g.enter().append("circle"),g.attr("class",function(b){return a.x+"-"+a.y+" graph splom p"+b[2]+" c"+b[3]}).attr("cx",function(a){return o(a[0])}).attr("cy",function(a){return p(a[1])}),g.exit().remove(),d.select(".correlation-line").datum(a.points).attr("d",e)}}function w(a){var b=q.extent();d3.selectAll("circle").classed("faded",!0),selected=brushCellData.filter(function(a){return a[0]>=b[0][0]&&a[0]<=b[1][0]&&a[1]>=b[0][1]&&a[1]<=b[1][1]}).map(function(a){return a[2]}),selected.forEach(function(a){d3.selectAll(".p"+a).classed("faded",!1)}),d3.selectAll(".link").classed("faded",function(a){return selected.indexOf(a.source.id)==-1||selected.indexOf(a.target.id)==-1})}function x(a){q.empty()&&d3.selectAll(".faded").classed("faded",!1)}function y(a){var g,b=data.nodes.map(function(b){return b[a.x]}),c=data.nodes.map(function(b){return b[a.y]}),d=data.nodes.map(function(a){return null!==a.cluster?a.cluster:"X"}),e=b.length,f=[];for(i=-1;++i<e;!0)null!==b[i]&&null!==c[i]&&(g=[b[i],c[i],i2ID(i),d[i]],f.push(g));return f}function z(a,b,c,d){var e=data.domains[a],f=data.domains[c],g=data.correlations[b][d],h=e[0],i=e[1],j=g.intercept+h*g.slope,k=g.intercept+i*g.slope;j<f[0]&&(j=f[0],h=(j-g.intercept)/g.slope),j>f[1]&&(j=f[1],h=(j-g.intercept)/g.slope),k<f[0]&&(k=f[0],i=(k-g.intercept)/g.slope),k>f[1]&&(k=f[1],i=(k-g.intercept)/g.slope);var l=[{x:h,y:j},{x:i,y:k}];return l}var d=d3.select(b).select("#splom"),e=$(b).height()-40,f=$(b).width(),j={inside:5,outside:15},k=d3.min([e-40,f])-2*j.outside,l=null,m=attributes.active().length,n=k/(m+1)-j.inside;d.html("");var o=d3.scale.linear().range([0,n]).domain([0,1]),p=d3.scale.linear().range([n,0]).domain([0,1]),q=d3.svg.brush().x(o).y(p).on("brushstart",function(a){v(a,this,!1)}).on("brush",function(a){w(a)}).on("brushend",function(a){x(a)}),v=function(a,b,c){r.displayCell(!0),l!==b&&d3.select(l).call(q.clear()),(l!==b||c)&&(o.domain(data.domains[a.x]),p.domain(data.domains[a.y]),r.plot(b,a),l=b,D=a,brushCellData=y(a)),c&&w(a)},A=d3.tip().attr("class","d3-tip").direction("w").offset([0,-10]).html(function(b){return"<table><tr><td class='detail-labels'>p-value </td><td class='detail-values'>"+b.p_value+"</td></tr><tr><td class='detail-labels'>r-value </td><td class='detail-values'>"+b.r_value+"</td></tr><tr><td class='detail-labels'>regression </td><td class='detail-values'>"+b.slope+"x + "+b.intercept+"</td></tr><tr><td class='detail-labels'>standard error </td><td class='detail-values'>"+b.std_err+"</td></tr><tr><td colspan=2 class='text-subtitle'>SPEARMAN </td></tr><tr><td class='detail-labels'>p-value </td><td class='detail-values'>"+a(b.p_value_SP,3)+"</td></tr><tr><td class='detail-labels'>rho </td><td class='detail-values'>"+a(b.rho_SP,3)+"</td></tr></table>"}),B=d.append("svg").attr("width",f).attr("height",e).append("g").attr("transform","translate("+j.outside+","+j.outside+")"),C=B.selectAll(".cell").data(t(data.columns,data.columns)).enter().append("g").attr("class",function(a){return a.i==a.j?"cell-diagonal":a.i<a.j?"cell unused":"cell"}).attr("transform",function(a){return"translate("+(m-a.i-1)*(n+j.inside)+","+a.j*(n+j.inside)+")"});C.append("rect").attr("height",n).attr("width",n).attr("class",function(a){return a.i>a.j?"rect-subgraph":"rect-diagonal"}),C.append("text").attr("x",10).attr("y",n/2).attr("class","splom-subgraph-text").text(function(a){return a.i==a.j?attributes.prettyprint1(data.columns[a.i]):""}),C.append("text").attr("x",n-45).attr("y",14).attr("class","splom-pvalue"),C.append("path").attr("class","correlation-line"),B.selectAll(".cell").call(q).call(A),$(".unused").remove(),B.selectAll(".cell").on("mouseover",function(){var a=d3.select(this).data()[0],b=data.correlations[a.i][a.j];A.show(b)}).on("mouseout",A.hide),r=new SplomFocusPlot("#splom",k,n),r.displayCell(!1);var D;this.updateVis=function(){C.each(function(a){u(a,this)}),D&&v(D,l,!0),r.plot()};var E=d.append("div").attr("class","form-group pull-right");E.append("button").attr("class","btn btn-default").attr("role","button").attr("id","btnBigSplomHighlight").style("display","none").html("Highlight selected proteins"),this.updateVis()},ViewTab=function(a){var b=this,c=d3.select("#nodeList"),d=d3.select("#clusterList"),f=d3.select("#viewTabGroup");this.view="nodeListTab",this.switchView=function(a){a!==b.view&&(b.view=a,f.selectAll(".active").classed("active",!1),d3.select("#"+a).classed("active",!0),c.style("display","nodeListTab"==b.view?"block":"none"),d.style("display","clusterListTab"==b.view?"block":"none"),"clusterListTab"==b.view&&$(e).trigger("updateClusterScatter"))},d.style("display","none"),f.selectAll("li").on("click",function(){b.switchView($(this)[0].id)})},ProteinSearch=function(a){function k(a){var b=a.filter(function(a){return c.indexOf(a)==-1});return!!b.length&&b}var c=(a.select(".media-list"),[]),f=this,h="add-to-individual-list",i="add-to-cluster-list";g={cluster:null,domains:[],domainData:[],dLength:0},$("#protein_search").selectivity({multiple:!0,closeOnSelect:!1,ajax:{url:"./query",dataType:"json",minimumInputLength:3,quietMillis:250,params:function(a,b){return{q:a,species:ss.species}},processItem:function(a){return{id:a.domain,text:a.domain,text2:a.uniprot,description:a.function2?a.genes+" | "+a.function2+"; "+a.function1:a.genes}},results:function(a,b){return d=a,{results:a,more:!1}}},placeholder:"Search for a protein",templates:{resultItem:function(a){return'<div class="selectivity-result-item" data-item-id="'+a.id+'"><b>'+a.text+"</b> <small>"+a.text2+'</small><br><span class="lightened">'+a.description.slice(0,40)+"</span></div>"}}}),$("#protein_search").on("selectivity-close",function(){f.individualSearch($("#protein_search").selectivity("value"),!0)}),$("#btnProteinSearch").on("click",function(){f.individualSearch($("#protein_search").selectivity("value"),!0)});var j=function(a){return{data:a.map(function(a){return a.chains.map(function(a){return a.id})})}};this.individualSearch=function(a,b){Array.isArray(a)||(a=[a]),$("#protein_search").selectivity("clear");var d=k(a);if(d){var f=$.param({species:ss.species,domains:d});$.ajax({url:"fetch_proteins/",type:"POST",data:f}).done(function(a){var c={domainData:a};if($(e).trigger(h,c),b){var d=j(a);$(e).trigger("highlightDomains",d)}});c=c.concat(a)}return!0},this.clusterSearch=function(a,b){var c,d,f=!1;for(g.cluster=a.cluster,g.domainData=[],g.domains=a.clusterdata,g.dLength=a.clusterdata.length;g.domains.length>0;){c=g.domains.splice(0,10);var d=$.param({species:ss.species,domains:c});$.ajax({url:"fetch_proteins/",type:"POST",data:d}).done(function(a){if(g.domainData=g.domainData.concat(a),f=g.domainData.length==g.dLength,f&&($(e).trigger(i,g),b)){var c=j(g.domainData);$(e).trigger("highlightDomains",c)}})}},this.removeProtein=function(a){c.remove(a)},this.proteins=function(){return c}},ClusterScatter=function(a,b,c){var d=a,f=this,g=10,h=!1,i=$("#view").height()-$("#viewTabGroup").height()-5,j={top:5,right:10,bottom:25,left:20},k=c-j.left-j.right,l=b-j.top-j.bottom-q,m=b/4-j.top-j.bottom-q,n=d3.scale.ordinal().rangeRoundBands([j.left,k]),p=d3.scale.ordinal().rangeRoundBands([j.top,l]),r=d3.scale.ordinal().rangeRoundBands([j.top,l/4]),s=function(a){return n(a.i)+(n.rangeBand()-g)/2},t=function(a){return p(a.size)+(p.rangeBand()-g)/2},u=function(a){return r(a.size)},v=d3.svg.axis().scale(p).orient("left"),w=d.append("svg").attr("width",k+j.left+j.right).attr("height",l+j.top+j.bottom),x=w.append("g").attr("transform","translate("+j.left+","+j.top+")");x.append("g").attr("class","y axis").attr("transform","translate("+j.left+",0)").call(v),x.append("text").attr("class","y label").attr("y",j.top).attr("x",j.left+10).attr("transform","rotate(90)").text("cluster size"),this.updateVis=function(){f.data=data.clusters.filter(function(a){return a.size>2});var a=data.cluster_frequencies.map(function(a){return a.size}).filter(function(a){return 2!==a});n.domain(d3.range(1,d3.max(f.data,function(a){return a.i})+1)),p.domain(a),r.domain(a),x.select(".y.axis").call(v);var b=x.selectAll(".cluster").data(f.data);b.enter().append("rect").attr("height",g).attr("width",g),b.attr("x",s).attr("y",t).attr("class",function(a,b){return"cluster c"+b}).style("fill",o).on("mouseover",function(a){$(e).trigger("clusterHighlight",a)}).on("mouseout",function(a){$(e).trigger("removeClusterHighlight")}).on("click",function(a,b){bSelected=!0,$(e).trigger("clusterClicked",[a,b])}),b.exit().remove()},this.updateColor=function(){x.selectAll(".cluster").style("fill",o)},this.scrunch=function(a){var c=!(d3.select("#cluster_list").selectAll(".collapsed")[0].length==d3.select("#cluster_list").selectAll(".panel")[0].length);(c!=h||a)&&(c&&!a?(x.classed("scrunched",!0),x.selectAll(".cluster").transition().duration(500).attr("height",2).attr("y",u),x.selectAll(".y").style("display","none"),w.transition().duration(500).attr("height",m+j.top+j.bottom),b=i-(m+j.top+j.bottom)):(x.classed("scrunched",!1),x.selectAll(".cluster").transition().duration(500).attr("height",g).attr("y",t),x.selectAll(".y").style("display",null),w.transition().duration(500).attr("height",l+j.top+j.bottom),b=i-(l+j.top+j.bottom)),h=a?!a:c,$("#cluster_list").height(b))},d.on("mouseover",function(){f.scrunch(!0)})},ClusterList=function(a){function h(a){var c,b={};return a.cluster.forEach(function(a){c=data.nodes[ID2i(a)].domain,b[c]=[]}),d3.keys(b)}var b=a,g=b.append("div").attr("class","clusterview panel-group").attr("id","cluster_list");this.clear=function(){g.selectAll("div").remove()},this.addContent=function(a){var b=g.append("div").attr("class","panel panel-default"),c=b.append("div").attr("class","panel-heading").attr("id","row"+a.id).attr("href","#panel"+a.id).attr("data-toggle","collapse").attr("aria-expanded","false").attr("aria-controls","col"+a.id).attr("data-parent","#cluster_list").html('<span class="badge">'+a.size+'</span><span data-target="#mDataexport" data-toggle="modal" class="glyphicon glyphicon-save pull-right download" id="download-'+a.id+'"></span>');
c.select(".download").on("click",function(){$("#mlDataexport").html("Download options - selected cluster"),d3.select("#mb-tab-corr").attr("class","disabled"),$("#dataExport_triggeredby").val(a.id),console.log("TO: add cluster detail to modal form header")}),b.append("div").attr("class","panel-collapse collapse").attr("id","panel"+a.id).attr("aria-labelledby","row"+a.id).attr("role","tabpanel").append("ul").attr("class","media-list").attr("id","list"+a.id),c.datum(a).on("mouseover",function(){$(this).children(".glyphicon").show(),$(e).trigger("clusterHighlight",a)}).on("mouseout",function(){$(this).children(".glyphicon").hide(),$(e).trigger("removeClusterHighlight")}).on("click",function(a){if(!d3.select(this).classed("loaded")){var b=h(a),c={cluster:a,clusterdata:b};d3.select(this).classed("loaded",!0),$(e).trigger("getClusterDetails",c)}$(e).trigger("scrunch")})}},ProteinMediaItem=function(){function h(a){var b=c.append("li").attr("class","media").attr("id","media-object-"+a.domain).datum(a),g=b.append("div").attr("class","media-left"),h=g.append("div").attr("class","view third-effect");h.append("img").attr("class","media-object").attr("src",j(a.domain,a.chains[0].chain)).attr("alt",a.domain),h.append("div").attr("class","mask").html('<a href="#" class="info" title="Full Image">+</a>').on("click",function(){l(a)});var m=g.append("div").attr("class","label-chains-group"),n=b.append("div").attr("class","media-body");n.append("h4").attr("class","media-heading").html(i(a.domain,a.function2)),"yeast"==ss.species&&n.append("div").html("localization: "+(a.localizations.length?a.localizations.reduce(function(a,b){return a+", "+b}):" - ")),n.append("div").html(k(a.uniprot,a.domain)),n.append("div").attr("class","collapse").attr("id","collapse-"+(d?"individual-":"cluster-")+a.domain).attr("aria-expanded","false").attr("aria-controls","collapse-"+(d?"individual-":"cluster-")+a.domain).append("div").attr("class","well function-well").html(a.function1.length?a.function1.reduce(function(a,b){return a+"<br>"+b}):"");var o=a.chains.map(function(a){return data.nodes[ID2i(a.id)]});m.selectAll("span.label").data(o).enter().append("span").attr("class",function(a){return"label label-default label-chains p"+a.id+" c"+(f?f:a.cluster)}).html(function(a){return a.chain}).on("click",function(a){d3.select(this).classed("highlight",!0),$(e).trigger("badgeClicked",a.id)}),n.select(".remove").on("click",function(){b.remove(),$(e).trigger("removeHighlight",a)}),n.select(".glyphicon.more").on("click",function(){"false"==$($(this).parent()).attr("aria-expanded")?d3.select(this).classed("glyphicon-plus",!1).classed("glyphicon-minus",!0):d3.select(this).classed("glyphicon-minus",!1).classed("glyphicon-plus",!0)})}function i(a,b){var c="<h4>";return c+="<a href='http://www.rcsb.org/pdb/explore/explore.do?structureId=",c+=a+"' target='_blank'>"+a+"</a> ",c+="<small>"+b+"</small>",d&&(c+="<a href='#'><span class='remove' style='float:right'>&times;</span></a>"),c}function j(a,b){return b?(a=a.toLowerCase(),"../static/img/"+a[0]+"/"+a[1]+"/"+a+b+".png"):"../static/img/"+a[0]+"/"+a[1]+"/"+a+".png"}function k(a,b){var c="genes: ";return c+=a.length?a.map(function(a){var b="<a href='http://www.uniprot.org/uniprot/"+a.uniprot+"' target='_blank'>"+a.genes.split(" ")[0]+"</a>";return b+=" <small>("+a.uniprot+")</small>"}).reduce(function(a,b){return a+", "+b}):"-",c+='<a data-toggle="collapse" href="#collapse-'+(d?"individual-":"cluster-")+b+'" title="More..." aria-expanded="false" aria-controls="collapse-'+(d?"individual-":"cluster-")+b+'">',c+="<span style='float:right' class='more glyphicon glyphicon-plus'></span></a>"}function l(a){g.html(""),g.selectAll("a").data(a.chains).enter().append("a").attr("class","lightbox-modal").attr("href",function(b){return j(a.domain,b.chain)}).attr("data-lightbox","lightbox-modal").attr("data-title",function(a){return m(a.id)}).append("img").attr("src",function(b){return j(a.domain,b.chain)}),$(".lightbox-modal")[0].click()}function m(a){var b=data.nodes[ID2i(a)],c='<span class="lb-chainTitle">'+b.pdb+'</span><table class="lb-chainTable"><tbody>';return attributes.all().forEach(function(a){c+="<tr><td>"+attributes.prettyprint2(a)+"</td><td class='detail-values'>"+n(b,a)+"</td></tr>"}),c+="</tbody></table>"}function n(b,c){var d=b[c];return attributes.log(c)&&(d=Math.pow(10,d)),d?a(d,attributes.decimalplaces(c)):""}var c,d,f,g=d3.select("#lightbox-div");this.clear=function(a){a?d3.select(a).selectAll("#individual_list"==a?"li":".panel.panel-default").remove():(d3.select("#individual_list").selectAll("li").remove(),d3.select("#cluster_list").html(""))},this.addDomainsToList=function(a,b,e){c=b,d="individual_list"==c.attr("id"),f=e;var g=Array.isArray(a)?a:[a];g.forEach(function(a,b){h(a)})}},Highlighter=function(a){var d,b=Array.isArray(a)?a:[],c=0;this.highlightedProteins=function(){return b};var e=function(a){return"<style id='style-p"+a+"' class='style-highlight'> circle.p"+a+"{ fill: "+t(c)+" !important;}.pcg.p"+a+"{r:15;}.pcg.highlight-center.p"+a+"{r:35;}.splom.p"+a+" {r:3 !important; stroke:"+t(c)+" !important ;}.label-chains.p"+a+" { background-color:"+t(c)+";}</style>"},f=function(a){return"circle.c"+a+"{ fill: "+t(c)+";}.pcg.c"+a+"{r:15;}.splom.c"+a+" {r:3 !important; stroke:"+t(c)+" !important ; fill:"+t(c)+" !important ;}.label-chains.c"+a+" { background-color:"+t(c)+";}.cluster.c"+a+"{fill:"+t(c)+"!important;}"};this.highlight=function(a,g){if(a)if(Array.isArray(a)&&a.length>1)a.forEach(function(a){d=e(a),$("head").append(d)});else{var h=Array.isArray(a)?a[0]:a;d=e(h),$("head").append(d),d3.select(".pcg.p"+h).classed("highlight",!0),b.push(h)}else d=f(g),d3.select("head").insert("style",".style-highlight").attr("id","style-c"+g).attr("class","style-highlight-cluster").html(d);c+=1},this.removeHighlight=function(a,d){a?(Array.isArray(a)||(a=[a]),a.forEach(function(a){b.remove(a),$("#style-p"+a).remove(),d3.selectAll(".highlight.p"+a).classed("highlight",!1),data.nodes[ID2i(a)].highlight=!1})):d?$("#style-c"+d).remove():($(".style-highlight").remove(),$(".style-highlight-cluster").remove(),d3.selectAll(".highlight").classed("highlight",!1),b=[],c=0)},this.removeProtein=function(a){b.remove(a)},this.hoverHighlight=function(a,b){a.cluster.forEach(function(a){d3.selectAll("circle.p"+a).classed("protein-hover",!0).moveToFront()}),b&&(d3.selectAll("circle.p"+b.id).classed("protein-center-hover",!0).moveToFront(),d3.selectAll(".cluster.c"+b.cluster).classed("protein-hover",!0))},this.removeHoverHighlight=function(){d3.selectAll(".protein-hover").classed("protein-hover",!1),d3.selectAll(".protein-center-hover").classed("protein-center-hover",!1)},this.updateHighlight=function(){$(".style-highlight-cluster").remove()}},DataExportModal=function(){var b=d3.select("#mbDataexport"),c=d3.select("#mbSPLOMexport"),d=["pdb"].concat(attributes.all());b.select("#main-options").selectAll("label").data(d).enter().append("label").attr("class","btn active").html(function(a){return"<input name='columns' type='checkbox' value='"+a+"' checked>"+(attributes.isAttr(a)?attributes.prettyprint2(a):a.toUpperCase())+" <span class='modal-button-checkmarks glyphicon glyphicon-ok'></span></input><br>"}),c.select("#correlation-main-options").selectAll("label").data(attributes.all()).enter().append("label").attr("class","btn active").html(function(a){return"<input name='columns' type='checkbox' value='"+a+"' checked>"+(attributes.isAttr(a)?attributes.prettyprint2(a):a.toUpperCase())+" <span class='modal-button-checkmarks glyphicon glyphicon-ok'></span></input><br>"}),$("#mbDataexport").submit(function(){var a=$("#dataExport_triggeredby").val();if(""==a)$("#dataExport_nodes").val(JSON.stringify(data.nodes));else{var b=data.clusters[parseInt(a)].cluster.map(function(a){return data.nodes[ID2i(a)]});$("#dataExport_nodes").val(JSON.stringify(b))}return $("#dataExport_TMi").val(ss.tmi),$("#dataExport_TMf").val(ss.tmf),$("#dataExport_SIDi").val(ss.sidi),$("#dataExport_SIDf").val(ss.sidf),$("#dataExport_species").val(ss.species),"0"!==$(".more-options.active>input").val()&&($("#exportEdges").submit(function(){return $("#dataExport_edges").val($(".more-options.active>input").val()),$("#dataExport_edges_TMi").val(ss.tmi),$("#dataExport_edges_TMf").val(ss.tmf),$("#dataExport_edges_SIDi").val(ss.sidi),$("#dataExport_edges_SIDf").val(ss.sidf),$("#dataExport_edges_species").val(ss.species),!0}),setTimeout(function(){$("#exportEdges").submit()},1e3)),!0}),$("#mbSPLOMexport").submit(function(){return $("#splomExport_correlations").val(JSON.stringify(data.correlations)),$("#splomExport_column_order").val(JSON.stringify(data.columns)),$("#splomExport_TMi").val(ss.tmi),$("#splomExport_TMf").val(ss.tmf),$("#splomExport_SIDi").val(ss.sidi),$("#splomExport_SIDf").val(ss.sidf),$("#splomExport_species").val(ss.species),!0})},TMSID=function(a){function k(a){a.classed("highlight",!0)}function l(a,b){return"fetch_edge?ss.species="+ss.species+"&source="+a+"&target="+b}function m(a,b){return null!==b?"#ls"+a+"t"+b:"#ls"+d3.min([a.source.id,a.target.id])+"t"+d3.max([a.source.id,a.target.id])}var d=[],f=[],h={},j=(d3.select(".vis"),null);this.addLinks=function(a){var b=a.id;d.indexOf(b)==-1&&(d.map(function(a){if(a!==b){var c=d3.min([a,b]),d=d3.max([a,b]),e={source:c,target:d,id:m(c,d),dashed:!1};$(e.id).length?k(d3.select(e.id)):(e.dashed=!0,f.push(e))}}),data.nodes[ID2i(b)].highlight=!0,d.push(b))},this.focusNode=function(a){j=a.id,d3.selectAll(".link.highlight").classed("highlight",function(a){return a.source.id==j||a.target.id==j}),d3.selectAll(".link:not(.highlight)").remove(),d3.selectAll("circle.pcg:not(.highlight)").remove(),d3.select(".pcg.p"+j).classed("highlight-center",!0).classed("highlight",!1);var b=f.filter(function(b){return b.source==a.id||b.target==a.id}),c=[],d=!1;b.forEach(function(a,b){$.getJSON(l(a.source,a.target)).done(function(b){var d={};d.ppi=b.ppi,d.tm=b.tm,d.sid=b.sid,d.dashed=!0,d.source=ID2i(a.source),d.target=ID2i(a.target),c.push(d)})});var g=function(){d?(f=d3.selectAll(".link.highlight").data().concat(c),h.edges=f,$(e).trigger("focus-forcevis",h)):(d=c.length==b.length,setTimeout(function(){g()},1e3))};g()}},TipLink=function(a){var c=a,d=d3.select("#link-text-tm"),e=d3.select("#link-text-sid");sourceImg=d3.select("#link-img-source"),targetImg=d3.select("#link-img-target"),sourceText=d3.select("#link-text-source"),targetText=d3.select("#link-text-target"),this.show=function(a,b,f){d.html(f.tm),e.html(f.sid),sourceImg.attr(w(b.pdb)),targetImg.attr(w(a.pdb)),sourceText.html(b.pdb),targetText.html(a.pdb),c.style("opacity",1)},this.hide=function(){c.style("opacity",0)}},ErrorMessage=function(){var a=$("#errorMessage");this.show=function(b){E.hide(),d3.select("#errorMessage").select(".modal-body").text(b),a.modal()}}}var ss={},data,ID2i,attributes;main();
